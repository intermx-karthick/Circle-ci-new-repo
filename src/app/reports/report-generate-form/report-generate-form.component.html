<form [formGroup]="reportGenerateForm" (ngSubmit)="onFormSubmit()" (window:resize)="reSize()">
  <mat-card class="report-form-card" fxLayout="column" >
    <div fxLayout="row" class="report-form-container" [ngClass]="{'enable-border': enableInvoiceOption}">
      <!-- left side form fields -->
      <div class="left-side" fxFlex="12.188rem">
        <div>
          <mat-form-field fxFlex="10rem" class="imx-input imx-dropdown">
            <mat-label>Select Category *</mat-label>
            <mat-select [panelClass]="'imx-select'" formControlName="categories" [compareWith]="compareFn">
              <mat-option *ngIf="reportCategories.length" [value]="null">Select Category</mat-option>
              <mat-option [value]="category" *ngFor="let category of reportCategories">{{category.name}}</mat-option>
            </mat-select>
            <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.categories?.errors?.required">
              Category required.
            </mat-error>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field fxFlex="10rem" class="imx-input imx-dropdown">
            <mat-label>Select Report type *</mat-label>
            <mat-select [panelClass]="'imx-select'" formControlName="categoryType" [compareWith]="compareFn">
              <mat-option *ngIf="!reportGenerateForm?.controls?.categories?.value" [value]="null"> Please select Category first</mat-option>
              <mat-option *ngIf="selectedReportTypes.length" [value]="null">Select Report type</mat-option>
              <mat-option [value]="type" *ngFor="let type of selectedReportTypes">{{type?.name}}</mat-option>
            </mat-select>
            <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.categoryType?.errors?.required">
              Report Type required.
            </mat-error>
          </mat-form-field>
        </div>
      </div><!-- left side form fields -->

      <!-- left side form fields -->
      <div class="right-side" fxFlex="100%">

        <div *ngIf="!enableInvoiceOption">
          <div>
            <mat-form-field fxFlex="10rem" class="imx-input imx-dropdown">
              <mat-label>Cost Type *</mat-label>
              <mat-select [panelClass]="'imx-select'" formControlName="costType">
                <mat-option *ngIf="costTypes.length" [value]="null">Select Cost Type</mat-option>
                <mat-option *ngFor="let costType of costTypes;trackBy: costTypeTrackByFn" [value]="costType?._id">{{costType?.name}}</mat-option>
              </mat-select>
              <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.costType?.errors?.required">
                Cost Type required.
              </mat-error>
            </mat-form-field>
          </div>

          <span fxFlex="1 1 auto"></span>

          <div fxLayoutAlign="start center">
            <mat-form-field class="imx-input" fxFlex="26.313rem">
              <mat-label>Report display name *</mat-label>
              <input matInput autocomplete="off" formControlName="reportDisplayName">
              <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.reportDisplayName?.errors?.required">
                Report Display Name required.
              </mat-error>
              <mat-error *ngIf="reportGenerateForm.controls?.reportDisplayName?.hasError('maxlength')">
                Report Display Name can be max 64 characters long.
            </mat-error>
            </mat-form-field>
            <div>
              <mat-icon class="information-icon" svgIcon="IMX-information"></mat-icon>
            </div>
          </div>
        </div>

        <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
          <div>
            <mat-form-field fxFlex="6.75rem" class="imx-input">
              <mat-label>Start Date*</mat-label>
              <input matInput formControlName="startDate" appDateFormat [max]="maxDate" [matDatepicker]="start_date_picker" />
              <mat-icon (click)="start_date_picker.open()" matSuffix class="date-picker-icon date-picker-icon_input"
                svgIcon="IMX-calender"></mat-icon>
              <mat-datepicker #start_date_picker="matDatepicker" [panelClass]="'imx-calander'"></mat-datepicker>
              <mat-error class="error-font"
                *ngIf="reportGenerateForm.controls?.startDate?.errors?.required && !reportGenerateForm.controls?.startDate?.errors?.matDatepickerParse">
                Start Date required. </mat-error>
              <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.startDate?.errors?.matDatepickerParse"> Invalid
                Date. </mat-error>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field fxFlex="6.75rem" class="imx-input"
              [ngClass]="{'mb-1rem' : reportGenerateForm.controls?.endDate?.errors?.matDatepickerMin}">
              <mat-label>End Date*</mat-label>
              <input matInput formControlName="endDate" appDateFormat [min]="minDateForEndDate"
                [max]="maxDate" [matDatepicker]="end_date_picker" />
              <mat-icon (click)="end_date_picker.open()" matSuffix class="date-picker-icon date-picker-icon_input"
                svgIcon="IMX-calender"></mat-icon>
              <mat-datepicker #end_date_picker="matDatepicker" [panelClass]="'imx-calander'"></mat-datepicker>
              <mat-error class="error-font"
                *ngIf="reportGenerateForm.controls?.endDate?.errors?.required && !reportGenerateForm.controls?.endDate?.errors?.matDatepickerParse">
                End Date required. </mat-error>
              <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.endDate?.errors?.matDatepickerParse"> Invalid Date.
              </mat-error>
              <mat-error class="error-font" *ngIf="reportGenerateForm.controls?.endDate?.errors?.matDatepickerMin">
                End Date must be >= Start Date. </mat-error>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field fxFlex="6.75rem" class="imx-input">
              <mat-label>Revised Since</mat-label>
              <input matInput formControlName="revisedSince" appDateFormat [max]="maxDate" [matDatepicker]="revised_date_picker" />
              <mat-error> Invalid Date.</mat-error>
              <mat-icon (click)="revised_date_picker.open()" matSuffix class="date-picker-icon date-picker-icon_input"
                svgIcon="IMX-calender"></mat-icon>
              <mat-datepicker #revised_date_picker="matDatepicker" [panelClass]="'imx-calander'"></mat-datepicker>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field fxFlex="6.75rem" class="imx-input">
              <mat-label>Entered Since</mat-label>
              <input matInput formControlName="enteredSince" appDateFormat [max]="maxDate" [matDatepicker]="entered_date_picker" />
              <mat-error> Invalid Date.</mat-error>
              <mat-icon (click)="entered_date_picker.open()" matSuffix class="date-picker-icon date-picker-icon_input"
                svgIcon="IMX-calender"></mat-icon>
              <mat-datepicker #entered_date_picker="matDatepicker" [panelClass]="'imx-calander'"></mat-datepicker>
            </mat-form-field>
          </div>
          <span fxFlex="1 1 auto"></span>
          <div *ngIf="enableInvoiceOption" fxLayout="row" fxLayoutAlign="start center">
            <mat-checkbox class="imx-checkbok error" formControlName="includeDeleted" disableRipple>Include Deleted I/Os
            </mat-checkbox>
            <div fxLayout="row">
              <mat-icon class="information-icon" svgIcon="IMX-information" tooltip="Checking this will include all Deleted Insertion Orders" placement="left" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip"></mat-icon>
            </div>
          </div>
        </div>

        <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
          <div>
            <mat-form-field fxFlex="10rem" class="imx-input imx-dropdown">
              <mat-label>Division</mat-label>
              <mat-select [panelClass]="'imx-select'" multiple formControlName="division">
                <mat-option *ngFor="let division of divisions" [value]="division?._id">{{division?.name}}</mat-option>
              </mat-select>
              <mat-hint>select for logo to appear</mat-hint>
            </mat-form-field>
          </div>
          <div class="mr-2rem">
            <mat-form-field fxFlex="10rem" class="imx-input imx-dropdown">
              <mat-label>Office</mat-label>
              <mat-select #officeRef multiple [panelClass]="'imx-select'" formControlName="office"
                tooltip="" placement="right" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                <div class="mat-select-panel__wrapper" infiniteScroll [infiniteScrollDistance]="1"
                  [infiniteScrollThrottle]="0" (scrolled)="officesAutoComplete.loadMoreData(null,null)"
                  [scrollWindow]="false">

                  <mat-option *ngFor="let office of officesAutoComplete.data" [value]="office?._id"
                    (onSelectionChange)="selectOfficeData($event, office)" tooltip="" placement="top" delay="200"
                    tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                    {{office?.name}}
                  </mat-option>

                  <mat-option disabled *ngIf="officesAutoComplete.isLoading">
                    <div fxLayout="row" fxLayoutAlign="space-around center">
                      <mat-spinner diameter="20"></mat-spinner>
                    </div>
                  </mat-option>
                </div>
              </mat-select>
            </mat-form-field>
          </div>
          <div>
            <mat-form-field fxFlex="9rem" class="imx-input imx-dropdown">
              <mat-label>Client Type</mat-label>
              <mat-select multiple [panelClass]="'imx-select'" formControlName="clientType">
                <mat-option *ngFor="let cTypes of clientTypes" [value]="cTypes?._id">{{cTypes?.name}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
          <div>
            <mat-form-field class="imx-input" fxFlex="10rem">
              <mat-label>Contract Number</mat-label>
              <input matInput autocomplete="off" formControlName="contractNumber" maxlength="20" appNumberOnly [canAllowMinus]="false">
            </mat-form-field>
          </div>
          <div class="mr-2rem">
            <mat-form-field class="imx-input" fxFlex="10rem">
              <mat-label>Contract Name</mat-label>
              <input matInput autocomplete="off" formControlName="contractName">
            </mat-form-field>
          </div>
          <div>
            <mat-form-field class="imx-dropdown imx-input" fxFlex="14.5rem"
                  tooltip="{{reportGenerateForm['controls'].campaign.value?.name ?.length>10 ? reportGenerateForm['controls'].campaign.value?.name : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Campaign</mat-label>

                  <input type="text" readonly  matInput [matAutocomplete]="campaignRef"
                    class="imx-input-no-border" #triggerCampaign="matAutocompleteTrigger" 
                    [autocompletePosition]="triggerCampaign" scrollContainer="report-form-card_SCROLLABLE" 
                    (click)="triggerCampaign.openPanel()"
                    [value]="campaignsAutoComplete?.selectedData?.length == 1 ? '1 Campaign selected' : (campaignsAutoComplete?.selectedData?.length > 1 ? campaignsAutoComplete?.selectedData?.length + ' Campaigns selected' : '') "/>

                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
                  <mat-autocomplete #campaignRef="matAutocomplete" (opened)="updateCampaignContainer()"
                    class="autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field imx-autocomplete-dropdown imx-autocomplete-dropdown"
                    panelWidth="230px" [displayWith]="campaignWithFn"
                    (optionSelected)="onSelectCampaign($event)" infiniteScroll [infiniteScrollDistance]="1"
                    [infiniteScrollThrottle]="0" [scrollWindow]="false" [fromRoot]="true" [immediateCheck]="false"
                    [alwaysCallback]="false"
                    [infiniteScrollDisabled]="campaignsAutoComplete.data?.length >= campaignsAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelCampaignContainer"
                    (scrolled)="campaignsAutoComplete.loadMoreData(null,null)">

                    <div fxLayout="row" class='auto-complete-search-field'>
                      <input type='text' placeholder='Search Campaigns' #campaignInputRef matInput
                             formControlName="campaign"  autocomplete='off' />
                      <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main campaign-list-autocomplete">
                      <mat-option *ngFor="let campaign of campaignsAutoComplete.data;trackBy: CampaignTrackByFn"
                        [value]="campaign" tooltip="{{campaign.name?.length >10 ? campaign.name : ''}}" placement="top"
                        (click)="campaignsAutoComplete.clickOption($event, campaign);"  delay="200" tooltipClass="imx-tooltip-v3" 
                        customClass="imx-field-tooltip" class="drop-maxwidth">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]="campaign.selected" (change)="campaignsAutoComplete.clickOption($event,campaign)"
                                      (click)='$event.stopPropagation()'>
                              <span [innerHTML]="campaign.name | imx_highlight: campaignInputRef.value"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="campaignsAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled
                        *ngIf="!campaignsAutoComplete.isLoading  && !campaignsAutoComplete.data?.length && campaignInputRef?.value">
                        Invalid Entry.
                      </mat-option>

                      <mat-option disabled *ngIf="!campaignsAutoComplete.isLoading && !campaignsAutoComplete.data?.length
                                                                  && !campaignInputRef?.value">
                        No Records.
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].campaign.hasError('invalid')">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
          </div>
        </div>

        <div fxLayout="row " fxLayoutAlign="start start">
          <!-- client details -->
          <div class="client-details-fields">

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field fxFlex="10rem" class="imx-dropdown imx-input"
                  tooltip="{{reportGenerateForm['controls'].clientParent.value?.name ?.length>10 ? reportGenerateForm['controls'].clientParent.value?.name : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Client Parent</mat-label>

                  <input type="text" readonly matInput class="imx-input-no-border"
                                        [matAutocomplete]="clientParent"
                                        #triggerCliParent="matAutocompleteTrigger" [autocompletePosition]="triggerCliParent"
                                        scrollContainer="report-form-card_SCROLLABLE" (click)="triggerCliParent.openPanel()"
                                        [value]="parentClientsAutoComplete?.selectedData?.length == 1 ? '1  client selected' : (parentClientsAutoComplete?.selectedData?.length > 1) ? parentClientsAutoComplete?.selectedData?.length + ' clients selected' : '' " />

                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>

                  <mat-autocomplete #clientParent="matAutocomplete" (opened)="updateClientParentContainer()"
                  class="autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field"
                    panelWidth="160px" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="0"
                    [scrollWindow]="false" [fromRoot]="true" [immediateCheck]="false" [alwaysCallback]="false"
                    [infiniteScrollDisabled]="parentClientsAutoComplete.data?.length >= parentClientsAutoComplete?.pagination?.total"
                    [displayWith]="clientParentDisplayWithFn" [infiniteScrollContainer]="panelClientParentContainer"
                    (scrolled)="parentClientsAutoComplete.loadMoreData(null,null)"
                    >

                    <div class="auto-complete-search-field" fxLayout="row">
                      <input type="text" placeholder="Search Clients" #clientParentInputRef matInput
                        formControlName="clientParent" />
                        <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main clientParent-list-autocomplete">
                      <mat-option *ngFor="let clientParent of parentClientsAutoComplete.data;trackBy: clientParentTrackByFn" [value]="clientParent" 
                        tooltip="{{clientParent.clientName?.length >10 ? clientParent.clientName : ''}}" placement="top"
                        delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip"
                        (click)="parentClientsAutoComplete.clickOption($event, clientParent);">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]="clientParent.selected" (change)="parentClientsAutoComplete.clickOption($event,clientParent)" (click)="$event.stopPropagation()">
                            <span [innerHTML]="clientParent.clientName | imx_highlight: clientParentInputRef.value"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="parentClientsAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled
                        *ngIf="!parentClientsAutoComplete.isLoading  && !parentClientsAutoComplete.data?.length">
                        Invalid Entry.
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].clientParent.hasError('invalid')">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>
              <div>

                <mat-form-field class="imx-dropdown imx-input" fxFlex="10rem"
                  tooltip="{{reportGenerateForm['controls'].agency.value?.name ?.length>10 ? reportGenerateForm['controls'].agency.value?.name : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Agency</mat-label>
                  <input type="text" matInput readonly [matAutocomplete]="agencyRef" class="imx-input-no-border" #triggerAgency="matAutocompleteTrigger" 
                    [autocompletePosition]="triggerAgency" scrollContainer="report-form-card_SCROLLABLE"
                    (click)="triggerAgency.openPanel()"
                    [value]="agenciesAutoComplete?.selectedData?.length == 1 ? '1  Agency selected' : (agenciesAutoComplete?.selectedData?.length > 1) ? agenciesAutoComplete?.selectedData?.length + ' Agencies selected' : '' " />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>

                  <mat-autocomplete #agencyRef="matAutocomplete" (opened)="updateAgencyContainer()"
                    class="autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field" 
                    panelWidth="160px" infiniteScroll [infiniteScrollDistance]="1"
                    [infiniteScrollThrottle]="0" [scrollWindow]="false" [fromRoot]="true" [immediateCheck]="false"
                    [alwaysCallback]="false" [displayWith]="agencyDisplayWithFn"
                    [infiniteScrollDisabled]="agenciesAutoComplete.data?.length >= agenciesAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelAgencyContainer"
                    (scrolled)="agenciesAutoComplete.loadMoreData(null,null)">

                    <div class="auto-complete-search-field" fxLayout="row">
                      <input type="text" placeholder="Search Agencies" #agencyInputRef matInput
                        formControlName="agency" />
                       <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main agency-list-autocomplete">
                      <mat-option *ngFor="let agency of agenciesAutoComplete.data;trackBy: agencyTrackByFn" [value]="agency" 
                        tooltip="{{agency.name?.length >10 ? agency.name : ''}}" placement="top"
                        delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip"
                        (click)="agenciesAutoComplete.clickOption($event, agency);">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]="agency.selected" (change)="agenciesAutoComplete.clickOption($event,agency)" (click)="$event.stopPropagation()">
                            <span [innerHTML]="agency.name | imx_highlight: agencyInputRef.value"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="agenciesAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled
                        *ngIf="!agenciesAutoComplete.isLoading  && !agenciesAutoComplete.data?.length">
                        Invalid Entry.
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].agency.hasError('invalid')">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field class="imx-input" fxFlex="5.7rem">
                  <mat-label>Client Code</mat-label>
                  <input matInput autocomplete="off" formControlName="clientCode">
                </mat-form-field>
              </div>

              <div>

                <mat-form-field fxFlex="14.3rem" class="imx-dropdown imx-input"
                  tooltip="{{reportGenerateForm['controls'].client.value?.clientName ?.length>10 ? reportGenerateForm['controls'].client.value?.clientName : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Client Name</mat-label>
                  <input type="text" #clientNameInputRef matInput [matAutocomplete]="clientNameRef"
                    formControlName="client" class="imx-input-no-border" #triggerClientName="matAutocompleteTrigger" 
                    [autocompletePosition]="triggerClientName" scrollContainer="report-form-card_SCROLLABLE" 
                    (click)="triggerClientName.openPanel()" />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
                  <mat-autocomplete #clientNameRef="matAutocomplete" (opened)="updateClientNameContainer()"
                    class="clientName-list-autocomplete imx-autocomplete-dropdown"
                    panelWidth="230px" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="0"
                    [scrollWindow]="false" [fromRoot]="true" [immediateCheck]="false" [alwaysCallback]="false"
                    [infiniteScrollDisabled]="clientsAutoComplete.data?.length >= clientsAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelClientNameContainer"
                    (scrolled)="clientsAutoComplete.loadMoreData(null,null)" [displayWith]="clientNameDisplayWithFn"
                    (optionSelected)="onSelectClient($event)">

                    <mat-option *ngFor="let client of clientsAutoComplete.data;trackBy: clientNameTrackByFn" [value]="client"
                      tooltip="{{client.clientName?.length >10 ? client.clientName : ''}}" placement="top" delay="200"
                      tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip" class="drop-maxwidth"
                      [class.mat-selected]="reportGenerateForm['controls'].client?.value?.clientName === client?.clientName">
                    <span [innerHTML]="client.clientName | imx_highlight: clientNameInputRef.value"></span>
                    </mat-option>

                    <mat-option disabled *ngIf="clientsAutoComplete.isLoading ">
                      <div fxLayout="row" fxLayoutAlign="space-around center">
                        <mat-spinner diameter="20"></mat-spinner>
                      </div>
                    </mat-option>

                    <mat-option disabled
                      *ngIf="!clientsAutoComplete.isLoading  && clientsAutoComplete.data?.length <= 0">
                      Invalid Entry.
                    </mat-option>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].client.hasError('invalid')" class="error-font">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>

            </div>

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field class="imx-input" fxFlex="5.7rem">
                  <mat-label>Product Code</mat-label>
                  <input matInput autocomplete="off" formControlName="productCode">
                </mat-form-field>
              </div>
              <div>

                <mat-form-field class="imx-dropdown imx-input" fxFlex="14.3rem"
                  tooltip="{{reportGenerateForm['controls'].product.value?.productName ?.length>10 ? reportGenerateForm['controls'].product.value?.productName : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Product Name</mat-label>
                  <input type="text" #productInputRef matInput [matAutocomplete]="productRef" formControlName="product"
                    class="imx-input-no-border" #triggerProductName="matAutocompleteTrigger" [autocompletePosition]="triggerProductName"
                    scrollContainer="report-form-card_SCROLLABLE" (click)="triggerProductName.openPanel()" />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
                  <mat-autocomplete #productRef="matAutocomplete" (opened)="updateProductContainer()"
                    class="autocomplete-scroll imx-autocomplete-dropdown product-list-autocomplete" panelWidth="230px"
                    [displayWith]="productDisplayWithFn" (optionSelected)="onSelectClientProduct($event)" infiniteScroll
                    [infiniteScrollDistance]="1" [infiniteScrollThrottle]="0" [scrollWindow]="false" [fromRoot]="true"
                    [immediateCheck]="false" [alwaysCallback]="false"
                    [infiniteScrollDisabled]="productsAutoComplete.data?.length >= productsAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelProductContainer"
                    (scrolled)="productsAutoComplete.loadMoreData(null,null)">

                    <mat-option *ngFor="let product of productsAutoComplete.data;trackBy: productTrackByFn" [value]="product"
                      tooltip="{{product.productName?.length >10 ? product.productName : ''}}" placement="top" delay="200" tooltipClass="imx-tooltip-v3"
                      customClass="imx-field-tooltip" class="drop-maxwidth"
                      [class.mat-selected]="reportGenerateForm['controls'].product?.value?.productName === product?.productName">
                      <span [innerHTML]="product.productName | imx_highlight: productInputRef.value"></span>
                    </mat-option>

                    <mat-option disabled *ngIf="productsAutoComplete.isLoading ">
                      <div fxLayout="row" fxLayoutAlign="space-around center">
                        <mat-spinner diameter="20"></mat-spinner>
                      </div>
                    </mat-option>

                    <mat-option disabled *ngIf="!productsAutoComplete.isLoading  && !productsAutoComplete.data?.length 
                                                  && isClientSelected && reportGenerateForm?.controls?.product?.value?.length">
                      Invalid Entry.
                    </mat-option>
                    <mat-option disabled *ngIf="!productsAutoComplete.isLoading && !productsAutoComplete.data?.length
                                        && isClientSelected && !reportGenerateForm?.controls?.product?.value?.length">
                      No Records.
                    </mat-option>
                    <mat-option disabled
                      *ngIf="!productsAutoComplete.isLoading && !productsAutoComplete.data?.length && !isClientSelected"
                      class="primary-color">
                      Please select Client first
                    </mat-option>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].product.hasError('invalid')" class="error-font">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field class="imx-input" fxFlex="5.7rem">
                  <mat-label>Estimate #</mat-label>
                  <input matInput autocomplete="off" formControlName="estimateId">
                </mat-form-field>
              </div>
              <div>

                <mat-form-field class="imx-dropdown imx-input" fxFlex="14.3rem"
                  tooltip="{{reportGenerateForm['controls'].estimate?.value?.estimateName ?.length>10 ? reportGenerateForm['controls'].estimate.value?.estimateName : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Estimate Name</mat-label>
                  <input type="text" readonly matInput [matAutocomplete]="estimateRef" class="imx-input-no-border" #triggerEstimate="matAutocompleteTrigger"
                    [autocompletePosition]="triggerEstimate" scrollContainer="report-form-card_SCROLLABLE"
                    (click)="triggerEstimate.openPanel()"
                    [value]="estimatesAutoComplete?.selectedData?.length == 1 ? '1  Estimate selected' : (estimatesAutoComplete?.selectedData?.length > 1) ? estimatesAutoComplete?.selectedData?.length + ' Estimates selected' : '' " />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
                  <mat-autocomplete #estimateRef="matAutocomplete" (opened)="updateEstimateContainer()"
                    class="autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field" panelWidth="230px"
                    [displayWith]="estimateDisplayWithFn" (optionSelected)="onSelectEstimateProduct($event)"
                    infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="0" [scrollWindow]="false"
                    [fromRoot]="true" [immediateCheck]="false" [alwaysCallback]="false"
                    [infiniteScrollDisabled]="estimatesAutoComplete.data?.length >= estimatesAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelEstimateContainer"
                    (scrolled)="estimatesAutoComplete.loadMoreData(null,null)">

                    <div class="auto-complete-search-field" fxLayout="row" *ngIf="isProductSelected">
                      <input type="text" placeholder="Search Estimates" #estimateInputRef matInput formControlName="estimate"
                        autocomplete="off" />
                      <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main estimate-list-autocomplete">
                      <mat-option *ngFor="let estimate of estimatesAutoComplete.data;trackBy: estimateTrackByFn"
                        [value]="estimate" tooltip="{{estimate.estimateName?.length >10 ? estimate.estimateName : ''}}" placement="top"
                        delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip" class="drop-maxwidth"
                        (click)="estimatesAutoComplete?.clickOption($event,estimate)">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]="estimate.selected" (change)="estimatesAutoComplete?.clickOption($event,estimate)"
                            (click)="$event.stopPropagation()">
                            <span [innerHTML]="estimate.estimateName | imx_highlight: reportGenerateForm?.value?.estimate"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="estimatesAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="!estimatesAutoComplete.isLoading && !estimatesAutoComplete.data?.length
                                          && isProductSelected && reportGenerateForm?.controls?.estimate?.value?.length">
                        Invalid Entry.
                      </mat-option>
                      
                      <mat-option disabled *ngIf="!estimatesAutoComplete.isLoading && !estimatesAutoComplete.data?.length
                                          && isProductSelected && !reportGenerateForm?.controls?.estimate?.value?.length">
                        No Records.
                      </mat-option>
                      
                      <mat-option disabled
                        *ngIf="!estimatesAutoComplete.isLoading && !estimatesAutoComplete.data?.length && !isProductSelected"
                        class="primary-color">
                        Please select Product first
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].estimate.hasError('invalid')" class="error-font">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
          </div> <!-- client details -->

          <!-- vendor details -->
          <div class="vendor-details-fields">
            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field class="imx-dropdown imx-input" fxFlex="14.5rem"
                  tooltip="{{reportGenerateForm['controls'].vendor.value?.name ?.length>10 ? reportGenerateForm['controls'].vendor.value?.name : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Vendor</mat-label>
                  <input type="text" readonly matInput [matAutocomplete]="vendorRef"
                  class="imx-input-no-border" #triggerVendor="matAutocompleteTrigger" [autocompletePosition]="triggerVendor"
                  scrollContainer="report-form-card_SCROLLABLE" (click)="triggerVendor.openPanel()"
                  [value]="vendorsAutoComplete?.selectedData?.length == 1 ? '1  Vendor selected' : (vendorsAutoComplete?.selectedData?.length > 1) ? vendorsAutoComplete?.selectedData?.length + ' Vendors selected' : '' " />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>

                  <mat-autocomplete #vendorRef="matAutocomplete" (opened)="updateVendorContainer()"
                    class="autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field" panelWidth="230px"
                    [displayWith]="vendorDisplayWithFn" (optionSelected)="onSelectVendorProduct($event)" infiniteScroll
                    [infiniteScrollDistance]="1" [infiniteScrollThrottle]="0" [scrollWindow]="false" [fromRoot]="true"
                    [immediateCheck]="false" [alwaysCallback]="false"
                    [infiniteScrollDisabled]="vendorsAutoComplete.data?.length >= vendorsAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelVendorContainer"
                    (scrolled)="vendorsAutoComplete.loadMoreData(null,null)">

                    <div class="auto-complete-search-field" fxLayout="row">
                      <input type="text" placeholder="Search Vendors" #vendorInputRef matInput formControlName="vendor"
                             autocomplete="off" />
                      <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main vendor-list-autocomplete">
                      <mat-option *ngFor="let vendor of vendorsAutoComplete.data;trackBy: vendorTrackByFn"
                        [value]="vendor" tooltip="{{vendor.name?.length >10 ? vendor.name : ''}}" placement="top"
                        delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip" class="drop-maxwidth"
                        (click)="vendorsAutoComplete.clickOption($event, vendor);">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]="vendor.selected" (change)="vendorsAutoComplete.clickOption($event,vendor)" (click)="$event.stopPropagation()">
                            <span [innerHTML]="vendor.name | imx_highlight: vendorInputRef.value"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="vendorsAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled
                        *ngIf="!vendorsAutoComplete.isLoading  && !vendorsAutoComplete.data?.length">
                        Invalid Entry.
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].vendor.hasError('invalid')">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>

              <div>
                <mat-form-field class="imx-dropdown imx-input" fxFlex="14.5rem"
                  tooltip="{{reportGenerateForm['controls'].parentVendor.value?.name ?.length>10 ? reportGenerateForm['controls'].parentVendor.value?.name : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Parent Vendor</mat-label>

                  <input type="text" readonly matInput [matAutocomplete]="vendorParentRef" class="imx-input-no-border"
                    #triggerVendorParent="matAutocompleteTrigger" [autocompletePosition]="triggerVendorParent"
                    scrollContainer="report-form-card_SCROLLABLE" (click)="triggerVendorParent.openPanel()"
                    [value]="parentVendorsAutoComplete?.selectedData?.length == 1 ? '1  Vendor selected' : (parentVendorsAutoComplete?.selectedData?.length > 0 ? parentVendorsAutoComplete?.selectedData?.length + ' Vendors selected': '')" />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
                  
                  <mat-autocomplete #vendorParentRef="matAutocomplete" (opened)="updateVendorParentContainer()"
                    class='autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field'
                    panelWidth="230px" [displayWith]="vendorParentDisplayWithFn"
                    (optionSelected)="onSelectVendorParentProduct($event)" infiniteScroll [infiniteScrollDistance]="1"
                    [infiniteScrollThrottle]="0" [scrollWindow]="false" [fromRoot]="true" [immediateCheck]="false"
                    [alwaysCallback]="false"
                    [infiniteScrollDisabled]="parentVendorsAutoComplete.data?.length >= parentVendorsAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelVendorParentContainer"
                    (scrolled)="parentVendorsAutoComplete.loadMoreData(null,null)">

                    <div class="auto-complete-search-field" fxLayout="row">
                      <input type="text" placeholder="Search Vendors" #vendorParentInputRef matInput formControlName="parentVendor"
                        autocomplete="off" />
                      <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main vendorparent-list-autocomplete">
                      <mat-option *ngFor="let vendor of parentVendorsAutoComplete.data;trackBy: vendorParentTrackByFn"
                        [value]="vendor" tooltip="{{vendor.name?.length >10 ? vendor.name : ''}}" placement="top"
                        delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip" class="drop-maxwidth"
                        (click)="parentVendorsAutoComplete?.clickOption($event, vendor)">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]="vendor.selected" (change)="parentVendorsAutoComplete?.clickOption($event,vendor)"
                            (click)="$event.stopPropagation()">
                            <span [innerHTML]="vendor.name | imx_highlight: vendorParentInputRef.value"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="parentVendorsAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled
                        *ngIf="!parentVendorsAutoComplete.isLoading  && !parentVendorsAutoComplete.data?.length">
                        Invalid Entry.
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-error *ngIf="reportGenerateForm['controls'].parentVendor.hasError('invalid')">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field fxFlex="14.5rem" class="imx-dropdown imx-input"
                  tooltip="{{reportGenerateForm['controls'].programmaticPartnerReseller.value?.name ?.length>10 ? reportGenerateForm['controls'].programmaticPartnerReseller.value?.name : ''}}"
                  placement="top" delay="200" tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip">
                  <mat-label>Programmatic Partner/Reseller</mat-label>

                  <input type="text" readonly matInput [matAutocomplete]="PartnerReseller" class="imx-input-no-border"
                    #triggerPartnerReseller="matAutocompleteTrigger" [autocompletePosition]="triggerPartnerReseller"
                    scrollContainer="report-form-card_SCROLLABLE" (click)="triggerPartnerReseller.openPanel()"
                    [value]="resellerAutoComplete?.selectedData?.length == 1 ? '1  Reseller selected' : (resellerAutoComplete?.selectedData?.length > 1) ? resellerAutoComplete?.selectedData?.length + ' Resellers selected' : '' " />
                  <mat-icon matSuffix>keyboard_arrow_down</mat-icon>
                 
                  <mat-autocomplete #PartnerReseller="matAutocomplete" (opened)="updatePartnerResellerContainer()"
                  class="autocomplete-scroll imx-autocomplete-dropdown imx-multiple inside-search-field"
                    panelWidth="232px" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="0"
                    [scrollWindow]="false" [fromRoot]="true" [immediateCheck]="false" [alwaysCallback]="false"
                    [infiniteScrollDisabled]="resellerAutoComplete.data?.length >= resellerAutoComplete?.pagination?.total"
                    [infiniteScrollContainer]="panelPartnerResellerContainer"
                    (scrolled)="resellerAutoComplete.loadMoreData(null,null)"
                    [displayWith]="PartnerResellerDisplayWithFn">

                    <div class="auto-complete-search-field" fxLayout="row">
                      <input type="text" placeholder="Search Partners/Resellers" #PartnerResellerInputRef matInput
                        formControlName="programmaticPartnerReseller" autocomplete="off" />
                      <mat-icon>search</mat-icon>
                    </div>

                    <div class="auto-complete-list-main partnerReseller-list-autocomplete">
                      <mat-option *ngFor="let pReseller of resellerAutoComplete.data;trackBy: PartnerResellerTrackByFn" [value]="pReseller"
                        tooltip="{{pReseller.name?.length >10 ? pReseller.name : ''}}" placement="top" delay="200"
                        tooltipClass="imx-tooltip-v3" customClass="imx-field-tooltip"
                        (click)="resellerAutoComplete?.clickOption($event,pReseller)">
                        <div (click)="$event.stopPropagation()">
                          <mat-checkbox [checked]='pReseller.selected' (change)="resellerAutoComplete?.clickOption($event,pReseller)"
                            (click)='$event.stopPropagation()'>
                            <span [innerHTML]="pReseller.name | imx_highlight: PartnerResellerInputRef.value"></span>
                          </mat-checkbox>
                        </div>
                      </mat-option>

                      <mat-option disabled *ngIf="resellerAutoComplete.isLoading ">
                        <div fxLayout="row" fxLayoutAlign="space-around center">
                          <mat-spinner diameter="20"></mat-spinner>
                        </div>
                      </mat-option>

                      <mat-option disabled
                        *ngIf="!resellerAutoComplete.isLoading  && !resellerAutoComplete.data?.length">
                        Invalid Entry.
                      </mat-option>
                    </div>
                  </mat-autocomplete>

                  <mat-error *ngIf="reportGenerateForm['controls'].programmaticPartnerReseller.hasError('invalid')">
                    Please select from the drop down list.
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field fxFlex="14.5rem" class="imx-input imx-dropdown">
                  <mat-label>Media Class</mat-label>
                  <mat-select [panelClass]="'imx-select'" multiple formControlName="mediaClass">
                    <mat-option *ngFor="let item of mediaClassIns?.data;trackBy: mediaByFn" [value]="item?.name">
                      {{item?.name}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div>
                <mat-form-field fxFlex="14.5rem" class="imx-input imx-dropdown">
                  <mat-label>Place Type</mat-label>
                  <mat-select [panelClass]="'imx-select'" multiple formControlName="placeType">
                    <mat-option *ngFor="let place of placeTypes;trackBy: placeTypeTrackByFn" [value]="place.name">{{place?.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div>
                <mat-checkbox class="imx-checkbok" formControlName="digitalOnly" disableRipple>Digital Only
                </mat-checkbox>
              </div>
            </div>

            <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem">
              <div>
                <mat-form-field fxFlex="14.5rem" class="imx-input imx-dropdown">
                  <mat-label>Media Type</mat-label>
                  <mat-select [panelClass]="'imx-select'" multiple formControlName="mediaType">
                    <mat-option *ngFor="let item of mediaTypeIns?.data" [value]="item?.name">
                      {{item?.name}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div>
                <mat-form-field fxFlex="14.5rem" class="imx-input imx-dropdown">
                  <mat-label>DMA</mat-label>
                  <mat-select [panelClass]="'imx-select'" multiple formControlName="market">
                    <mat-option *ngFor="let dmaValue of dma;trackBy: dmaTrackByFn" [value]="dmaValue?.id">{{dmaValue?.name}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

          </div><!-- vendor details -->
        </div>


      </div><!-- left side form fields -->

    </div>
    <!-- action section -->
    <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="1rem" class="mb-1rem">
      <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="1rem" *ngIf="enableInvoiceOption">
        <div>
          <mat-form-field fxFlex="6.313rem" class="imx-input">
            <mat-label>Invoice Date</mat-label>
            <input matInput appDateFormat [matDatepicker]="invoice_date_picker" [max]="maxDate" formControlName="invoiceDate" />
            <mat-error> Invalid Date.</mat-error>
            <mat-icon (click)="invoice_date_picker.open()" matSuffix class="date-picker-icon date-picker-icon_input"
              svgIcon="IMX-calender"></mat-icon>
            <mat-datepicker #invoice_date_picker="matDatepicker" [panelClass]="'imx-calander'"></mat-datepicker>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field fxFlex="6.313rem" class="imx-input">
            <mat-label>Due Date</mat-label>
            <input matInput appDateFormat [matDatepicker]="due_date_picker" [max]="maxDate" formControlName="dueDate" />
            <mat-error> Invalid Date.</mat-error>
            <mat-icon (click)="due_date_picker.open()" matSuffix class="date-picker-icon date-picker-icon_input"
              svgIcon="IMX-calender"></mat-icon>
            <mat-datepicker #due_date_picker="matDatepicker" [panelClass]="'imx-calander'"></mat-datepicker>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field class="imx-input" fxFlex="10.188rem">
            <mat-label>Invoice #</mat-label>
            <app-invoice-input formControlName="invoice"></app-invoice-input>
            <!-- <input matInput autocomplete="off" formControlName="invoice"> -->
            <mat-hint>O-1A-3823</mat-hint>
            <mat-error>Invoice should be valid</mat-error>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field class="imx-input" fxFlex="13.938rem">
            <mat-label>Line Item IDs</mat-label>
            <input matInput autocomplete="off" formControlName="lineItemID">
            <mat-hint>multi allowed, use ; to separate</mat-hint>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field class="imx-input" fxFlex="15.375rem">
            <mat-label>Invoice Notes</mat-label>
            <input matInput autocomplete="off" formControlName="invoiceNotes">
          </mat-form-field>
        </div>
      </div>
      <div fxFlex="1 1 auto"></div>
      <button mat-button type="button" class="imx-button-basic_icon" disableRipple (click)="onResetForm()">Reset</button>
      <button mat-raised-button class="imx-button-primary">Generate Report</button>
    </div>
  </mat-card>
</form>
